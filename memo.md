# Memo

テーマ: 自動販売機をモデリングする

## 2021.03.25

- やったこと
  - 飲料を値オブジェクトとして作成
  - １つユースケースを考えて実装
    - 100 円入れてソーダが買える
      - 100 円入れて 100 円で購入可能な飲料の一覧のを返却する
      - ランプを押すと対象の飲料が購入できる＆おつりが返却される
- やること
  - ドリンクの在庫を管理するリポジトリを作成する

## 2021.04.01

- やったこと
  - ドリンクの在庫を管理するリポジトリのインターフェースを作成
  - インターフェースを使ってユースケースを実装
  - ユースケース層のテストコードを実装
  - リポジトリを外部から注入
- やること
  - usecase を増やしていく
    - ボタンが押された Drink を返却する
  - テストケースを増やす
    - 金額に応じた
    - テスト NG の場合もやりたい

## 2021.04.15

- やったこと
  - `list-drink-available-for-purchase`のテストケースを追加
- やること
  - `item`というエンティティを`list-drink-available-for-purchase`返却する必要があるので再度ドメインのモデリングする
    - 購入可能な商品を返却する必要がある
    - 同じ`drink`の配列を返しても意味がないので
  - ボタンが押された Drink を返却する usecase を作成する

## 2021.04.22

- やったこと
  - `item`というエンティティをモデリングした
- やること
  - `list-drink-available-for-purchase` で Item エンティティを返却する必要があるので再度ユースケースのモデリングをする
    - 購入可能な商品を返却する必要がある
    - 同じ`drink`の配列を返しても意味がないので
  - ボタンが押された Drink を返却する usecase を作成する

## 2021.05.06

- やったこと
  - `list-drink-available-for-purchase` のテストをほしかったものに変更
- やること
  - ボタンが押された Drink を返却する usecase を作成する

## 2021.05.13

- やったこと
  - ボタンが押された Drink を返却する usecase を作成する
- やること
  - id を採番せずに Item をインスタンス化する方法を実装する（DDD 設計入門 Chapter9）
  - ボタンが押された Drink を返却する usecase のテストを実装する
  - 自販機のアイテムをドリンクだけに絞るか相談する
  - 光ってないボタンが押下されてもこのユースケースは呼び出されない（controller 側で制御する？）
  - 自販機にいくら入っているかという状態を管理する必要がある
  - おつりは返す？

## 2021.05.20

- やったこと
  - id を採番して Item をインスタンス化する場合はファクトリを利用するように修正する（DDD 設計入門 Chapter9）
  - ボタンが押された Drink を返却する usecase のテストを実装する
  - 在庫の概念を追加する
- やること
  - 自販機にいくら入っているかという状態を管理する必要がある
  - おつりは返す
  - 光ってないボタンが押下されてもこのユースケースは呼び出されない（controller 側で制御する？）
  - 自販機のアイテムをドリンクだけに絞るか相談する

## めも

- value object とは？
  - 1. 不変である
  - 2. 交換が可能である
    - 再代入は OK だが、メソッドを生やしてオブジェクト内部の値を書き換えるのは禁止
      - ex) OK
        - `var fullName = new Fullname("seiichi", "arai")`
        - `fullName = new Fullname("haruna", "oka")`
  - 3. 等価性によって比較される
    - クラスの比較メソッドを使って属性を比較する
- entity とは？
  - 1. 可変である
  - 2. 同じ属性であっても区別される
  - 3. 同一性によって区別される
    - クラスの比較メソッドを使って**id**を比較する
- value object と entity の違い
  - id を持つのが entity
  - システムによって value object なのか entity なのかは異なる
  - value object と entity は排他的（value object かつ entity という状態は存在しない）
  - <https://little-hands.hatenablog.com/entry/2018/12/09/entity-value-object>
- ドメインサービス
  - > 値オブジェクトやエンティティに記述すると不自然になってしまう振る舞いが存在します。ドメインサービスはそういった不自然さを解決するオブジェクトです。
  - 複数の値オブジェクト/エンティティがやり取りする中で、いずれかの値オブジェクト/エンティティに振る舞いとして持たせるのは不自然なケースにおいて利用されるイメージ
